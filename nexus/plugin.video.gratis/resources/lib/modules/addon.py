import xbmcimport xbmcguiimport xbmcpluginimport sysimport resolveurlfrom urllib.parse import unquote_plus, parse_qslfrom addonvar import addon_icon, addon_fanartfrom resources.lib.modules.utils import addDirfrom resources.lib.modules.vc import VC, BSTvc = VC()bs = BST()def MainMenu():	xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Main Menu')		addDir('Latest Movies','',2,addon_icon, addon_fanart,'Watch the Latest Movies')	addDir('Trending Movies','',3,addon_icon, addon_fanart,'Watch the Latest Trending Movies')	addDir('Latest Episodes','',4,addon_icon, addon_fanart,'Watch the Latest Series Episodes')	addDir('Latest Seasons', vc.series_url, 13, addon_icon, addon_fanart, 'Watch the Latest Series Seasons')	addDir('BS Latest', vc.featured_series_url, 17, addon_icon, addon_fanart,'Watch the Latest Episodes')		addDir('BS Popular Series', vc.featured_series_url, 22, addon_icon, addon_fanart,'Popular Series')	addDir('Search','',10, addon_icon, addon_fanart,'Search Movies and Series')#---VC Menus---#def latest_movies():	xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Movies')	main = vc.get_main(vc.movies_url, vc.movies_url)	for item in main[:-1]:		addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	addDir('Next Page', main[-1],6,'','','Open the Next Page')def featured_movies():	xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Trending Movies')	main = vc.get_main(vc.featured_movies_url, vc.featured_movies_url)	for item in main[:-1]:		addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	addDir('Next Page', main[-1],7,'','','Open the Next Page')def latest_series(_type=None):	if _type == 'season':		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Series Seasons')	else:		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Series Episodes')	main = vc.get_main(vc.series_url, vc.series_url)	for item in main[:-1]:		if _type == 'season':			if ' episode ' in item['name'].lower() and ' season ' in item['name'].lower():				name = item['name'].split(' Episode')[0].strip(':').strip('-')				addDir(name, item['url'], 12, item['icon'], addon_fanart, name)		else:			addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	if _type == 'season':		addDir('Next Page', main[-1],15,'','','Open the Next Page')	else:		addDir('Next Page', main[-1],8,'','','Open the Next Page')def featured_series(_type=None):	if _type == 'season':		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Featured Series Seasons')	else:		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Featured Series Episodes')	main = vc.get_main(vc.featured_series_url, vc.featured_series_url)	for item in main[:-1]:		if _type == 'season':			if ' episode ' in item['name'].lower() and ' season ' in item['name'].lower():				name = item['name'].split(' Episode')[0].strip(':').strip('-')				addDir(name, item['url'], 12, item['icon'], addon_fanart, name)		else:			addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	if _type == 'season':		addDir('Next Page', main[-1],16,'','','Open the Next Page')	else:		addDir('Next Page', main[-1],9,'','','Open the Next Page')def latest_movies_nextpage(_url):	xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Movies')	main = vc.get_main(_url, vc.movies_url)	for item in main[:-1]:		addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	addDir('Next Page', main[-1],6,'','','Open the Next Page')def featured_movies_nextpage(_url):	xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Trending Movies')	main = vc.get_main(_url, vc.featured_movies_url)	for item in main[:-1]:		addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	addDir('Next Page', main[-1],7,'','','Open the Next Page')def latest_series_nextpage(_url, _type=None):	if _type == 'season':		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Series Seasons')	else:		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Latest Series Episodes')	main = vc.get_main(_url, vc.series_url)	for item in main[:-1]:		if _type == 'season':			if ' episode ' in item['name'].lower() and ' season ' in item['name'].lower():				name = item['name'].split(' Episode')[0].strip(':').strip('-')				addDir(name, item['url'], 12, item['icon'], addon_fanart, name)		else:			addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	if _type == 'season':		addDir('Next Page', main[-1],15,'','','Open the Next Page')	else:		addDir('Next Page', main[-1],8,'','','Open the Next Page')def featured_series_nextpage(_url, _type=None):	if _type == 'season':		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Featured Series Seasons')	else:		xbmcplugin.setPluginCategory(int(sys.argv[1]), 'Featured Series Episodes')	main = vc.get_main(_url, vc.featured_series_url)	for item in main[:-1]:		if _type == 'season':			if ' episode ' in item['name'].lower() and ' season ' in item['name'].lower():				name = item['name'].split(' Episode')[0].strip(':').strip('-')				addDir(name, item['url'], 12, item['icon'], addon_fanart, name)		else:			addDir(item['name'],item['url'],11,item['icon'],addon_fanart ,item['name'])	if _type == 'season':		addDir('Next Page', main[-1],16,'','','Open the Next Page')	else:		addDir('Next Page', main[-1],9,'','','Open the Next Page')def from_keyboard():	kb = xbmc.Keyboard('', 'Search', False)	kb.doModal()	if (kb.isConfirmed()):		return kb.getText()	else:		returndef search(_url, page, icon, description):	if page == '':		page = 2		_url = vc.search_url + from_keyboard().replace(' ', '%20')	else:		page = int(page) + 1	main = vc.get_main(_url)	if len(main) >= 1:		for item in main:			if ' episode ' in item['name'].lower() and ' season ' in item['name'].lower():				name = item['name'].split(' Episode')[0].strip(':').strip('-')				addDir(name, item['url'], 12, item['icon'], addon_fanart, name)			else:				name = item['name']				addDir(name, item['url'], 11, item['icon'], addon_fanart, name)		addDir('Next Page', _url + f'&page={str(page)}', 10, icon, addon_fanart , description, page=page)	else:		addDir('No More Items to Display', '', '', '', addon_fanart , 'No More Items to Display', isFolder=False)def season_menu(url):	xbmcplugin.addSortMethod(int(sys.argv[1]), xbmcplugin.SORT_METHOD_TITLE)	for title, link, icon in vc.get_season(url):		addDir(title, link, 11, icon, addon_fanart, title)def links_page(title, _url, iconimage):	xbmcplugin.setPluginCategory(int(sys.argv[1]), title)	links = vc.get_links(_url)	desc = links[-1]	counter = 1	for link in links[:-1]:		addDir('Link ' + str(counter) + ': ' + link[0],link[1],1,iconimage,addon_fanart , title + ':\n\n' + desc,name2=title,isFolder=False)		counter+=1def play_video(title, link, iconimage, desc, title2):    link = unquote_plus(link)    liz = xbmcgui.ListItem(title)    liz.setInfo('video', {'title': title2, 'plot':desc})    liz.setArt({'thumb': iconimage, 'icon': iconimage})    if resolveurl.HostedMediaFile(link).valid_url():    	link = resolveurl.HostedMediaFile(link).resolve()    xbmc.Player().play(link,liz)#---BS Menus---#def bshows1(url):	for x in bs.get_latest(url)[:-1]:		addDir(x.get('name'), x.get('url'), 18, x.get('icon'), x.get('fanart'),'')	addDir('Next Page', bs.get_latest(url)[-1], 21, '', '', 'Next Page')def bshows2(url):	for x in bs.get_links(url):		addDir(x.get('name'), x.get('url'), 23, '', '', '', isFolder=False)def bshows_series(url):	for x in bs.browse_shows(url)[:-1]:		addDir(x.get('name'), x.get('url'), 20, x.get('icon'), addon_fanart,'')	addDir('Next Page', bs.browse_shows(url)[-1], 19, '', '', 'Next Page')def bshows_episodes(url):	xbmcplugin.addSortMethod(int(sys.argv[1]), xbmcplugin.SORT_METHOD_TITLE)	for x in bs.all_episodes(url):		addDir(x.get('name'), x.get('url'), 18, x.get('icon'), addon_fanart,'')def router(paramstring):    p = dict(parse_qsl(paramstring))    xbmc.log(str(p),xbmc.LOGDEBUG)        name = p.get('name', '')    name2 = p.get('name2', '')    url = p.get('url', '')    if p.get('mode') is None: mode = None    else: mode = int(p.get('mode'))    icon = p.get('icon', addon_icon)    fanart = p.get('fanart', addon_fanart)    description = p.get('description', '')    if p.get('page') is None: page = ''    else: page = int(p.get('page'))        xbmcplugin.setContent(int(sys.argv[1]), 'movies')        if mode is None:    	MainMenu()    	    elif mode == 1:    	play_video(name, url, icon,description,name2)    	    elif mode == 2:    	latest_movies()    	    elif mode == 3:    	featured_movies()    	    elif mode == 4:    	latest_series()    	    elif mode == 5:    	featured_series()    	    elif mode == 6:    	latest_movies_nextpage(url)    	    elif mode == 7:    	featured_movies_nextpage(url)    	    elif mode == 8:    	latest_series_nextpage(url)    	    elif mode == 9:    	featured_series_nextpage(url)    	    elif mode == 10:    	search(url, page, icon, description)    	    elif mode == 11:    	links_page(name, url, icon)    	    elif mode == 12:    	season_menu(url)    	    elif mode == 13:    	latest_series(_type='season')    	    elif mode == 14:    	featured_series(_type='season')    	    elif mode == 15:    	latest_series_nextpage(url, _type = 'season')    	    elif mode == 16:    	featured_series_nextpage(url, _type = 'season')    	    elif mode == 17:    	bshows1(bs.new_shows)    	    elif mode == 18:    	bshows2(url)    	    elif mode == 19:    	bshows_series(url)    	    elif mode == 20:    	bshows_episodes(url)    	    elif mode == 21:    	bshows1(url)    	    elif mode == 22:    	bshows_series(bs.most_popular)    	    elif mode == 23:    	play_video(name, url, icon, '', '')    xbmcplugin.endOfDirectory(int(sys.argv[1]))